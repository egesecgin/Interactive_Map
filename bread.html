<!DOCTYPE html>
<html>
<head>
    <meta charset='utf-8' />
    <title>3D Map with Mapbox GL JS</title>
    <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />
    <script src='https://api.mapbox.com/mapbox-gl-js/v3.0.0-beta.1/mapbox-gl.js'></script>
    <link href='https://api.mapbox.com/mapbox-gl-js/v3.0.0-beta.1/mapbox-gl.css' rel='stylesheet' />
    <link href='styles.css' rel='stylesheet' />
</head>
<body>
</head>
<body>
    <div id='map'></div>

    <div id="categoryFilters">
        <button id="allCategoriesButton" onclick="addMarkers()">All Categories</button>
        <label for="senseSelect">Sense:</label>
        <select id="senseSelect" multiple>
            <option value="Visual">Visual</option>
            <option value="Auditive">Auditive</option>
            <option value="Smell">Smell</option>
            <option value="Touch">Touch</option>
            <option value="Taste">Taste</option>
        </select>

        <label for="spaceSelect">Space:</label>
        <select id="spaceSelect" multiple>
            <option value="Abandoned Building">Abandoned Building</option>
            <option value="Seaside">Seaside</option>
            <option value="Under Water">Under Water</option>
            <option value="Inner Land">Inner Land</option>
        </select>

        <label for="typeSelect">Type:</label>
        <select id="typeSelect" multiple>
            <option value="Installation">Installation</option>
            <option value="Performance">Performance</option>
            <option value="Interactive">Interactive</option>
        </select>
    </div>

    <script>
    mapboxgl.accessToken = 'pk.eyJ1IjoiZXNlY2dpbiIsImEiOiJjbG1yajdiMG8wOGg3MnFydDAwaDNsaDk4In0.mwOTED4hBq4RBxEk0NbFXA';
    var map = new mapboxgl.Map({
        container: 'map',
        style: 'mapbox://styles/mapbox/standard-beta',
        center: [15.2, 45.1], // starting position
        zoom: 7, // starting zoom
        pitch: 60, // pitch in degrees
        bearing: -60, // bearing in degrees
        antialias: true // create the gl context with MSAA antialiasing, so custom layers are antialiased
    });

    var locations = [
    {
        name: "Zagreb",
        lat: 45.8150,
        lon: 15.9819,
        year: "2023",
        senses: ["Visual", "Smell"],
        spaces: ["Abandoned Building", "Seaside"],
        types: ["Installation", "Performance"],
        images: ["images/zagreb1.jpg", "images/zagreb2.jpg"],
        description: "Zagreb is the capital and the largest city of Croatia."
    },
    {
        name: "Dubrovnik Project",
        lat: 42.6507,
        lon: 18.0944,
        year: "2023",
        senses: ["Auditive", "Touch"],
        spaces: ["Under Water", "Inner Land"],
        types: ["Interactive"],
        images: ["dubrovnik1.jpg", "dubrovnik2.jpg"],
        description: "This lecture sucks"
    },
    // More locations here...
];

    var markers = []; // Array to store the markers

// Only keep this addMarkers function and remove the other
function addMarkers(category) {




    // Get the selected options from the select elements
    var senses = Array.from(document.getElementById('senseSelect').selectedOptions).map(option => option.value);
    var spaces = Array.from(document.getElementById('spaceSelect').selectedOptions).map(option => option.value);
    var types = Array.from(document.getElementById('typeSelect').selectedOptions).map(option => option.value);

    // First, remove all markers
    markers.forEach(function(marker) {
        marker.remove();
    });
    markers = [];

    // Then, add only the markers that match the selected categories
    locations.forEach(function(location) {
        if ((!senses.length || location.senses.some(sense => senses.includes(sense))) 
            && (!spaces.length || location.spaces.some(space => spaces.includes(space)))
            && (!types.length || location.types.some(type => types.includes(type)))) {
            
            var popup = new mapboxgl.Popup({ offset: 25 })
                .setHTML("<h3>" + location.name + "</h3>"
                            +"<img src='" + location.images[0] + "' alt='" + location.name + "' style='width: 200px; height: auto;'>"
                            +"<p>" + location.description + "</p>"
                            +"<p>Year: " + location.year + "</p>"
                            +"<p>Categories: " + location.categories.join(', ') + "</p>");

            var marker = new mapboxgl.Marker()
                .setLngLat([location.lon, location.lat])
                .setPopup(popup)
                .addTo(map);

            markers.push(marker); // Add the marker to the array
        }
    });
}

// Call the function initially with no category selected
map.on('load', function() {
    addMarkers();
});

// Update the map when the selected categories change
document.getElementById('senseSelect').addEventListener('change', addMarkers);
document.getElementById('spaceSelect').addEventListener('change', addMarkers);
document.getElementById('typeSelect').addEventListener('change', addMarkers);
    </script>
    
</body>
</html>
